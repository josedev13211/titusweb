<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Overlay</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #f700ff;
      width: 400px;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }

    .pokemon-overlay {
      width: 400px;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes slideIn {
      from {
        transform: scale(0.8) translateY(50px);
        opacity: 0;
      }
      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-15px);
      }
    }

    .pokemon-id {
      display: none;
    }

    .pokemon-name {
      display: none;
    }

    .pokemon-types {
      display: none;
    }

    .pokemon-sprite {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.3));
      animation: bounce 2s ease-in-out infinite;
      image-rendering: auto;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0) scale(1);
      }
      50% {
        transform: translateY(-20px) scale(1.05);
      }
    }

    .type-tag {
      display: none;
    }

    @keyframes popIn {
      from {
        transform: scale(0);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .type-tag:nth-child(1) { animation-delay: 0.3s; }
    .type-tag:nth-child(2) { animation-delay: 0.4s; }

    .type-normal { background: #A8A878; }
    .type-fire { background: #F08030; }
    .type-water { background: #6890F0; }
    .type-electric { background: #F8D030; color: #333; }
    .type-grass { background: #78C850; }
    .type-ice { background: #98D8D8; }
    .type-fighting { background: #C03028; }
    .type-poison { background: #A040A0; }
    .type-ground { background: #E0C068; }
    .type-flying { background: #A890F0; }
    .type-psychic { background: #F85888; }
    .type-bug { background: #A8B820; }
    .type-rock { background: #B8A038; }
    .type-ghost { background: #705898; }
    .type-dragon { background: #7038F8; }
    .type-dark { background: #705848; }
    .type-steel { background: #B8B8D0; }
    .type-fairy { background: #EE99AC; }

    .error-message {
      color: #666;
      font-size: 1.5rem;
      text-align: center;
      padding: 40px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(102, 126, 234, 0.2);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="overlay-content">
    <div class="error-message">
      <div class="loading-spinner"></div>
      Cargando Pokémon...
    </div>
  </div>

  <script>
    function getBestAnimatedImage(pokemon, isShiny = false) {
      const animatedOptions = isShiny ? [
        pokemon.sprites.versions?.['generation-v']?.['black-white']?.animated?.front_shiny,
        pokemon.sprites.other?.showdown?.front_shiny,
        pokemon.sprites.other?.['official-artwork']?.front_shiny,
        pokemon.sprites.other?.home?.front_shiny,
        pokemon.sprites.front_shiny
      ] : [
        pokemon.sprites.versions?.['generation-v']?.['black-white']?.animated?.front_default,
        pokemon.sprites.other?.showdown?.front_default,
        pokemon.sprites.other?.['official-artwork']?.front_default,
        pokemon.sprites.other?.home?.front_default,
        pokemon.sprites.front_default
      ];
      
      return animatedOptions.find(sprite => sprite) || (isShiny ? pokemon.sprites.front_shiny : pokemon.sprites.front_default);
    }

    function translateType(type) {
      const translations = {
        normal: "Normal", 
        fire: "Fuego", 
        water: "Agua", 
        electric: "Eléctrico",
        grass: "Planta", 
        ice: "Hielo", 
        fighting: "Lucha", 
        poison: "Veneno",
        ground: "Tierra", 
        flying: "Volador", 
        psychic: "Psíquico", 
        bug: "Bicho",
        rock: "Roca", 
        ghost: "Fantasma", 
        dragon: "Dragón", 
        dark: "Siniestro",
        steel: "Acero", 
        fairy: "Hada"
      };
      return translations[type] || type;
    }

    async function loadPokemon() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const pokemonId = urlParams.get('id');
        const isShiny = urlParams.get('shiny') === 'true';
        
        if (!pokemonId) {
          document.getElementById('overlay-content').innerHTML = 
            '<div class="error-message">❌ No se especificó un Pokémon</div>';
          return;
        }

        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`);
        
        if (!response.ok) {
          throw new Error('Pokémon no encontrado');
        }

        const pokemon = await response.json();
        const sprite = getBestAnimatedImage(pokemon, isShiny);
        
        const types = pokemon.types.map(t => 
          `<span class="type-tag type-${t.type.name}">${translateType(t.type.name)}</span>`
        ).join('');

        document.getElementById('overlay-content').innerHTML = `
          <div class="pokemon-overlay">
            <div class="pokemon-id">#${String(pokemon.id).padStart(3, '0')}</div>
            <img src="${sprite}" 
                 alt="${pokemon.name}" 
                 class="pokemon-sprite"
                 crossorigin="anonymous">
            <h1 class="pokemon-name">${pokemon.name}</h1>
            <div class="pokemon-types">${types}</div>
          </div>
        `;
      } catch (error) {
        console.error('Error cargando Pokémon:', error);
        document.getElementById('overlay-content').innerHTML = 
          '<div class="error-message">❌ Error al cargar el Pokémon<br><small>' + error.message + '</small></div>';
      }
    }

    loadPokemon();
  </script>
</body>
</html>